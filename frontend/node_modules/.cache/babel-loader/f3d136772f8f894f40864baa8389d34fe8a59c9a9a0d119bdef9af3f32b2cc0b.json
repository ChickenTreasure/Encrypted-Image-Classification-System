{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ImageCard from \"@/components/ImageCard.vue\";\nexport default {\n  // eslint-disable-next-line\n  name: \"Search\",\n  components: {\n    ImageCard\n  },\n  data() {\n    return {\n      dialogImageUrl: \"\",\n      dialogVisible: false,\n      disabled: false,\n      uploadUrl: process.env.VUE_APP_BASE_API + \"/upload_img\",\n      fileList: [],\n      labelColor: [\"\", \"success\", \"info\", \"warning\", \"danger\"],\n      responseImage: [],\n      filterImage: [],\n      tags: [],\n      disallowedTags: [],\n      collectImage: [],\n      currentPage: 1,\n      isSearching: false,\n      isCollectionLoading: false,\n      num: 9\n    };\n  },\n  created() {\n    this.$axios({\n      method: \"get\",\n      url: \"/tags\"\n    }).then(response => {\n      this.tags = response.data.map(item => {\n        item.status = true;\n        return item;\n      });\n      this.disallowedTags = [];\n    });\n  },\n  methods: {\n    handleRemove() {\n      this.fileList.splice(0, 1);\n    },\n    uploadSuccess(response) {\n      console.log(\"上传成功！\");\n      this.responseImage = response;\n      this.isSearching = false;\n    },\n    handleChange(file) {\n      if (this.fileList.length === 1) {\n        return;\n      }\n      this.fileList = [];\n      this.fileList.push(file);\n    },\n    searchRes() {\n      this.isSearching = true;\n      this.$refs.uploadRef.submit();\n    },\n    tagChange() {\n      let disallowedTags = [];\n      this.tags.forEach(item => {\n        if (!item.status) {\n          disallowedTags.push(item.label);\n        }\n      });\n      this.disallowedTags = disallowedTags;\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n    },\n    getCollection() {\n      this.isCollectionLoading = true;\n      this.$axios({\n        method: \"get\",\n        url: \"/collect/all\"\n      }).then(response => {\n        this.collectImage = response.data;\n      }).finally(() => {\n        this.isCollectionLoading = false;\n      });\n    }\n  }\n};","map":{"version":3,"names":["ImageCard","name","components","data","dialogImageUrl","dialogVisible","disabled","uploadUrl","process","env","VUE_APP_BASE_API","fileList","labelColor","responseImage","filterImage","tags","disallowedTags","collectImage","currentPage","isSearching","isCollectionLoading","num","created","$axios","method","url","then","response","map","item","status","methods","handleRemove","splice","uploadSuccess","console","log","handleChange","file","length","push","searchRes","$refs","uploadRef","submit","tagChange","forEach","label","handleCurrentChange","val","getCollection","finally"],"sources":["src/views/Search.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"search-content\">\r\n      <div class=\"search-upload\">\r\n        <h3 class=\"search-content-title\" style=\"display:inline-block;\">点我上传图片哦～</h3>\r\n        <!-- 上传图片的按钮 -->\r\n        <el-upload :action=uploadUrl :limit=\"1\" list-type=\"picture\" :auto-upload=\"false\" :multiple=\"false\"\r\n          :file-list=\"fileList\" :on-success=\"uploadSuccess\" :on-change=\"handleChange\" :on-remove=\"handleRemove\"\r\n          accept=\"image/png, image/jpeg\" ref=\"uploadRef\" :class=\"fileList.length >= 1 ? 'styleA' : 'styleB'\">\r\n          <!-- 上传图片的按钮 -->\r\n          <el-button size=\"medium\" type=\"primary\" style=\"display:inline-block;\">\r\n            <i slot=\"default\" class=\"el-icon-plus\" style=\"margin-right: 5%\"></i>点击上传\r\n          </el-button>\r\n        </el-upload>\r\n      </div>\r\n      <!-- 显示上传的图片 -->\r\n      <el-dialog :visible.sync=\"dialogVisible\">\r\n        <img width=\"70%\" height=\"70%\" :src=\"dialogImageUrl\" alt=\"\" />\r\n      </el-dialog>\r\n      <!-- 选择图片展示的数量 -->\r\n      <el-row class=\"input-row\">\r\n        <div style=\"display: flex;\">\r\n          <div style=\"font-size: medium;font-weight: revert;width: 144px;position:relative;top:5px;\">图像分类结果数:</div>\r\n          <el-input-number style=\"margin-left: 1%;\" size=\"small\" v-model=\"num\" :min=\"1\" :max=\"9\"></el-input-number>\r\n          <!-- 搜索按钮 -->\r\n          <el-button :disabled=\"fileList.length === 0 || isSearching\" @click=\"searchRes\"\r\n            style=\"margin-top: 2%; z-index: 1000;margin-left: 2%;position:relative;top:-11px;\" type=\"primary\"><i\r\n              :class=\"isSearching ? 'el-icon-loading' : 'el-icon-search'\" style=\"margin-right: 5%;\" />\r\n            搜索</el-button>\r\n        </div>\r\n      </el-row>\r\n    </div>\r\n\r\n\r\n    <!-- 分割线 -->\r\n    <el-divider></el-divider>\r\n    <div v-if=\"responseImage.length === 0\" style=\"display: flex; align-items: center; justify-content: center;\">\r\n      <el-empty description=\"No result\" />\r\n      <img style=\"width: 10%; height: 10%; margin-left: 10px;\" src=\"../assets/avatar.jpeg\" alt=\"\" />\r\n    </div>\r\n    <div v-else>\r\n      <el-row>\r\n        <el-col :span=\"24\">\r\n          <!--tag list-->\r\n          <div class=\"label-list\">\r\n            <el-row>\r\n              <el-col v-for=\"(item, index) in tags\" :key=\"index\" :span=\"2\">\r\n                <el-tag :type=\"labelColor[index % labelColor.length]\" :hit=\"true\" style=\"margin-top: 10px\">\r\n                  <el-checkbox v-model=\"item.status\" @change=\"tagChange\" />\r\n                  {{ item.label }}({{ item.size }})\r\n                </el-tag>\r\n              </el-col>\r\n            </el-row>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n\r\n      <el-divider></el-divider>\r\n      <el-row style=\"width: 100%\">\r\n        <el-col :span=\"24\">\r\n          <div style=\"width: 90%; margin: 0 auto\">\r\n            <el-row>\r\n              <el-col v-for=\"(item, index) in responseImage.slice(0, num)\" :key=\"index\" :span=\"6\">\r\n                <ImageCard :disallowedTags=\"disallowedTags\" :hideTags=\"true\" :imageId=\"item\" />\r\n              </el-col>\r\n            </el-row>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport ImageCard from \"@/components/ImageCard.vue\";\r\n\r\nexport default {\r\n  // eslint-disable-next-line\r\n  name: \"Search\",\r\n  components: {\r\n    ImageCard,\r\n  },\r\n  data() {\r\n    return {\r\n      dialogImageUrl: \"\",\r\n      dialogVisible: false,\r\n      disabled: false,\r\n      uploadUrl: process.env.VUE_APP_BASE_API + \"/upload_img\",\r\n      fileList: [],\r\n      labelColor: [\"\", \"success\", \"info\", \"warning\", \"danger\"],\r\n      responseImage: [],\r\n      filterImage: [],\r\n      tags: [],\r\n      disallowedTags: [],\r\n      collectImage: [],\r\n      currentPage: 1,\r\n      isSearching: false,\r\n      isCollectionLoading: false,\r\n\r\n      num: 9,\r\n    };\r\n  },\r\n  created() {\r\n    this.$axios({\r\n      method: \"get\",\r\n      url: \"/tags\",\r\n    }).then((response) => {\r\n      this.tags = response.data.map((item) => {\r\n        item.status = true;\r\n        return item;\r\n      });\r\n      this.disallowedTags = [];\r\n    });\r\n  },\r\n  methods: {\r\n    handleRemove() {\r\n      this.fileList.splice(0, 1);\r\n    },\r\n    uploadSuccess(response) {\r\n      console.log(\"上传成功！\");\r\n      this.responseImage = response;\r\n      this.isSearching = false;\r\n    },\r\n    handleChange(file) {\r\n      if (this.fileList.length === 1) {\r\n        return;\r\n      }\r\n      this.fileList = [];\r\n      this.fileList.push(file);\r\n    },\r\n    searchRes() {\r\n      this.isSearching = true;\r\n      this.$refs.uploadRef.submit();\r\n    },\r\n    tagChange() {\r\n      let disallowedTags = [];\r\n      this.tags.forEach((item) => {\r\n        if (!item.status) {\r\n          disallowedTags.push(item.label);\r\n        }\r\n      });\r\n      this.disallowedTags = disallowedTags;\r\n    },\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val;\r\n    },\r\n    getCollection() {\r\n      this.isCollectionLoading = true;\r\n      this.$axios({\r\n        method: \"get\",\r\n        url: \"/collect/all\",\r\n      })\r\n        .then((response) => {\r\n          this.collectImage = response.data;\r\n        })\r\n        .finally(() => {\r\n          this.isCollectionLoading = false;\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style scoped>\r\n\r\n.search-upload,\r\n.select-show-num {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.input-row {\r\n  display: flex;\r\n  margin-top: 15px;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.input-row > * + * {\r\n  margin-left: 10px;\r\n}\r\n\r\n.input-row span {\r\n  font-size: medium;\r\n  font-weight: revert;\r\n}\r\n\r\n.el-button {\r\n  margin-top: 20px;\r\n  margin-bottom: 20px;\r\n}\r\n/* .el-input-number__decrease:before, \r\n.el-input-number__increase:before, \r\n.el-input-number__decrease:after, \r\n.el-input-number__increase:after {\r\n  padding-top: 10px;\r\n} */\r\n</style>\r\n"],"mappings":";AAyEA,OAAAA,SAAA;AAEA;EACA;EACAC,IAAA;EACAC,UAAA;IACAF;EACA;EACAG,KAAA;IACA;MACAC,cAAA;MACAC,aAAA;MACAC,QAAA;MACAC,SAAA,EAAAC,OAAA,CAAAC,GAAA,CAAAC,gBAAA;MACAC,QAAA;MACAC,UAAA;MACAC,aAAA;MACAC,WAAA;MACAC,IAAA;MACAC,cAAA;MACAC,YAAA;MACAC,WAAA;MACAC,WAAA;MACAC,mBAAA;MAEAC,GAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,MAAA;MACAC,MAAA;MACAC,GAAA;IACA,GAAAC,IAAA,CAAAC,QAAA;MACA,KAAAZ,IAAA,GAAAY,QAAA,CAAAxB,IAAA,CAAAyB,GAAA,CAAAC,IAAA;QACAA,IAAA,CAAAC,MAAA;QACA,OAAAD,IAAA;MACA;MACA,KAAAb,cAAA;IACA;EACA;EACAe,OAAA;IACAC,aAAA;MACA,KAAArB,QAAA,CAAAsB,MAAA;IACA;IACAC,cAAAP,QAAA;MACAQ,OAAA,CAAAC,GAAA;MACA,KAAAvB,aAAA,GAAAc,QAAA;MACA,KAAAR,WAAA;IACA;IACAkB,aAAAC,IAAA;MACA,SAAA3B,QAAA,CAAA4B,MAAA;QACA;MACA;MACA,KAAA5B,QAAA;MACA,KAAAA,QAAA,CAAA6B,IAAA,CAAAF,IAAA;IACA;IACAG,UAAA;MACA,KAAAtB,WAAA;MACA,KAAAuB,KAAA,CAAAC,SAAA,CAAAC,MAAA;IACA;IACAC,UAAA;MACA,IAAA7B,cAAA;MACA,KAAAD,IAAA,CAAA+B,OAAA,CAAAjB,IAAA;QACA,KAAAA,IAAA,CAAAC,MAAA;UACAd,cAAA,CAAAwB,IAAA,CAAAX,IAAA,CAAAkB,KAAA;QACA;MACA;MACA,KAAA/B,cAAA,GAAAA,cAAA;IACA;IACAgC,oBAAAC,GAAA;MACA,KAAA/B,WAAA,GAAA+B,GAAA;IACA;IACAC,cAAA;MACA,KAAA9B,mBAAA;MACA,KAAAG,MAAA;QACAC,MAAA;QACAC,GAAA;MACA,GACAC,IAAA,CAAAC,QAAA;QACA,KAAAV,YAAA,GAAAU,QAAA,CAAAxB,IAAA;MACA,GACAgD,OAAA;QACA,KAAA/B,mBAAA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}